<!DOCTYPE HTML>

<html>
   <head>
      <meta charset="utf-8"/>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.bundle.js"></script>
      <script type = "text/javascript">
        var ws;
        var wsConnected = false

        function WebSocket_GetSetPoint(){
          var handleGetSetPointAnswer = function (jsonobj) {
            document.getElementById("SetPoint").value = jsonobj.SetPoint
          }
          WebSocketClient("GetSetPoint",handleGetSetPointAnswer)
        }

        function WebSocket_SetSetPoint(){
          var setPoint = document.getElementById("SetPoint").value;          
          alert("SetSetPoint " + setPoint)

          var handleSetSetPointAnswer = function (jsonobj) {
            alert("SetSetPoint to " + jsonobj.SetPoint)
          }
          WebSocketClient("SetSetPoint " + setPoint,handleSetSetPointAnswer)
        }

        function WebSocketClient(commandToSend,messageHandler) {
          if ("WebSocket" in window) {
            // Let us open a web socket
            ws = new WebSocket("ws://192.168.178.21:7654");
            ws.onopen = function() {
              ws.send(commandToSend);
            };                   // Web Socket is connected, send data using send()
            ws.onmessage = function(evt) {
                var received_msg = evt.data;
                alert(received_msg)
                var jsonobj = JSON.parse(received_msg)                  
                messageHandler(jsonobj)
            };

            ws.onclose = function() { 
            };

            ws.onerror = function(evt) {
              alert('ws normal error: ' + evt.type);
            };  
          } else {
              // The browser doesn't support WebSocket
              alert("WebSocket NOT supported by your Browser!");
          }                       
        }
        window.onload = function() {
            alert("Reload")
            var intervalID = setInterval(WebSocket_GetSetPoint, 10000);
        };
      </script>
   </head>
   <body>
    <div>
      Set Point: <input type="number" step="1" id="SetPoint" value="0.0">
      <input type="submit" value="Submit" onclick="WebSocket_SetSetPoint();" />
     </div>
      <div style="height: 300px">
         <canvas id="myChart"></canvas>
      </div>      
   </body>
</html>